# ARG default values are overriden at build time

ARG VAULT_VERSION=1.17.3

FROM hashicorp/vault:${VAULT_VERSION}

ARG VAULT_USER_UID=100
ARG VAULT_USER_GID=1000

RUN apk add --update --no-cache curl openssl vim
RUN mkdir -p /etc/container-init.d # /vault/data
# RUN chown vault:vault /vault/data

COPY --chown=${VAULT_USER_UID}:${VAULT_USER_GID} --chmod=500 ./tools/script.sh /etc/container-init.d/script.sh
COPY --chown=${VAULT_USER_UID}:${VAULT_USER_GID} --chmod=500 ./conf/vault.hcl /vault/config/vault.hcl
# COPY --chmod=500 ./conf/payload.json payload.json

CMD [ "/etc/container-init.d/script.sh" ]
# ENTRYPOINT [ "tail", "-f", "/dev/null" ]