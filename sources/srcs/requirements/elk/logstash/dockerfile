# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    dockerfile                                         :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: jm <jm@student.42lyon.fr>                  +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/06/17 20:20:20 by jm                #+#    #+#              #
#    Updated: 2024/09/16 22:45:52 by jm               ###   ########lyon.fr    #
#                                                                              #
# **************************************************************************** #

ARG STACK_VERSION=8.14.1

FROM logstash:${STACK_VERSION}

ARG LOGSTASH_DIRS_TO_MAKE=.

USER 0

RUN <<EOF
mkdir -p ${LOGSTASH_DIRS_TO_MAKE}
chown -R 1000:1000 /usr/share/logstash
find /usr/share/logstash -maxdepth 1 -type d -exec chmod 00750 \{\} \;
find /usr/share/logstash -maxdepth 1 -type f -exec chmod o-rwx \{\} \;
EOF
#In '00777' file permission, 00 allows to unset eventual SUID,GUID,STICKY bit privilegies

COPY --chown=1000:1000 --chmod=500 ./tools/script.sh /usr/share/logstash/script.sh

USER 1000

# ENTRYPOINT ["/usr/local/bin/docker-entrypoint"]
ENTRYPOINT [ "bash", "/usr/share/logstash/script.sh" ]
# ENTRYPOINT [ "tail", "-f", "/dev/null" ]